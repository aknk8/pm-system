# テスト計画（詳細）

## 1. 目的
- 品質リスクを最小化し、主要機能の動作を保証する
- テストピラミッドに沿って効率的に検証する

## 2. テストピラミッド方針
- 単体テスト: 70%（関数/ユーティリティ/バリデーション）
- 統合テスト: 20%（API + DB）
- E2Eテスト: 10%（主要ユーザーフロー）

## 3. 優先度
- P0: 認証、マスタCRUD（clients/employees/partners/projects/contracts）
- P1: 実績CRUD（assignment-plans/work-records/monthly-actual-costs/revenues/expenses）
- P2: レポート（projects/pm/clients）、ダッシュボード

## 4. テスト種別と対象

### 4.1 単体テスト
対象:
- 変換/整形処理（数値・日付・null/undefined）
- 入力バリデーション（必須/範囲/形式）
- コントローラ補助処理（レスポンス整形）

例:
- 数値入力が空文字のとき null に変換
- 日付フォーマットの妥当性チェック

### 4.2 統合テスト（API）
対象:
- REST API と PostgreSQL の結合
- 認証/認可、CRUD、レポート取得

例:
- POST /api/v1/auth/login -> トークン取得
- GET/POST/PUT/DELETE /api/v1/clients
- GET /api/v1/reports/projects/:id/profit

### 4.3 E2Eテスト
対象:
- ログイン -> ダッシュボード -> 各管理画面の登録/編集/削除

例:
- admin ログイン -> クライアント登録 -> プロジェクト登録 -> 売上登録

## 5. テスト環境
- テスト用DBは本番と分離
- ローカルで実行可能な構成

## 6. テストデータ
- 最小限のマスタデータを用意
- 既存シードを利用し、必要に応じて追加

## 7. カバレッジ目標
- 単体テスト: 70%以上
- 統合テスト: P0/P1 APIの主要ケースを網羅
- E2E: 主要フローを各1ケース以上

## 8. 実施順序
1) 単体テスト
2) 統合テスト
3) E2Eテスト

## 9. 受け入れ基準
- P0が全て合格
- P1が主要ケースで合格
- E2Eで主要フローが通る
