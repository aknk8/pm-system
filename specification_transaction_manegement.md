

# システムの目的

ITコンサルティング、テストアウトソーシング、そしてライセンス販売という\*\*「ストック・フロー・労働集約」が混在するビジネスモデルを、一つのシステムで統合管理する。

---

# 全体俯瞰

まず、分析軸（プロジェクト・PM・クライアント）を固定するために、以下のようなマスタ構造とトランザクション（取引データ）の関係を整理します。

### **マスタ・定義**

* **組織・リソースマスタ**:  
  * **社員**: 標準原価（時給ベースまたは月額固定）、所属部署。  
  * **外部パートナー**: 契約単価（月額/日額/時給）、所属会社マスタ。  
* **クライアント・契約マスタ**: クライアント属性、支払条件。  
* **プロジェクトマスタ**: 担当PM、予算（売上・原価）、期間、**サービス種別（コンサル/テスト/ライセンス）**。

### **トランザクション（実績データ）**

* **予定データ**: 月ごとのアサイン計画（誰が・どのプロジェクトに・何時間）。  
* **実績データ（CSVインポート）**: 勤務実績（誰が・いつ・どのプロジェクトに・何時間）。  
* **売上・仕入データ**: ライセンス販売実績、パートナーへの支払確定額。

---

# 業務フローとシステム機能

勤務実績CSVを起点とした実績管理のフローを具体化します。

##  実績コストの登録プロセス

1. **CSV取り込み**: 勤怠システム等から「社員名/ID、日付、プロジェクトコード、稼働時間」をインポート。  
2. **コスト計算（二段階）**:  
   * **標準原価ベース**: 稼働時間 × 社員別標準単価 でプロジェクト原価を即時計上。  
   * **人件費実績ベース**: 月末の給与支給額に基づき、総労働時間 に対する プロジェクト稼働時間 の比率で給与を按分し、実際原価を算出。  
3. **パートナー管理**: パートナーの稼働実績を元に、支払通知書を発行・または請求書との照合。

## 
---

## 3\. 分析軸（損益管理）の設計

ご要望にある「プロジェクト・PM・クライアント」軸での分析を可能にするため、以下の計算式をシステム内で保持します。

$$\\text{プロジェクト利益} \= \\text{売上} \- (\\text{人件費実績 or 標準原価}) \- \\text{外部パートナー原価} \- \\text{その他経費}$$

### 

### **求められる分析レポート案**

* **PM別損益レポート**: PMが担当する複数プロジェクトの合算損益。PMの「採算意識」を可視化。  
* **クライアント別LTV分析**: 過去からの累積売上と利益率。  
* **予定実績乖離（Variance）分析**: 「計画時の工数」と「CSVから取り込んだ実工数」の差分を、標準原価ベースで金額換算してアラートを出す。

---

#




# 

# 

# システム機能

データモデルに基づき、業務の流れ（マスタ整備 → 実績登録 → 分析）に沿った画面構成案を整理しました。

「プロジェクト・PM・クライアント軸での分析」と「標準原価・人件費実績の比較」を、どの画面で実現するかを重点的に設計しています。

---

## **1\. マスタ管理カテゴリ（土台作り）**

システムの基本情報を管理する画面群です。

| 画面名 | 主な機能・管理項目 |
| :---- | :---- |
| **クライアント管理** | 顧客基本情報、契約状況の一覧・編集。 |
| **プロジェクト管理** | 予算（受注額）、PMアサイン、サービス種別（コンサル/テスト/販売）の設定。 |
| **社員マスタ管理** | 基本情報に加え、\*\*「標準単価（標準原価）」\*\*の履歴管理。 |
| **外部パートナー管理** | 所属会社、契約単価（時間単価や月額固定単価）の管理。 |

---

## **2\. 実績・運用カテゴリ（データ入力）**

日々の稼働やコスト、CSVインポートを行う画面群です。

| 画面名 | 主な機能・管理項目 |
| :---- | :---- |
| **予定・アサイン登録** | 月ごとのプロジェクト別・担当者別アサイン計画（工数）の入力。 |
| **勤務実績CSVインポート** | 勤怠データの取り込み。**マスタとの名寄せ・バリデーション機能**を含む。 |
| **月次給与実績登録** | 実際の給与支給総額の入力。**人件費実績ベースの単価算出**に使用。 |
| **諸経費・ライセンス仕入登録** | 旅費や、ライセンス販売に伴う仕入原価の入力。 |

---

## **3\. 分析・レポートカテゴリ（意思決定）**

ここがシステムの「出口」であり、最も重要な部分です。

| 画面名 | 分析のポイント |
| :---- | :---- |
| **総合ダッシュボード** | 全社売上・利益率、PM別利益ランキング、異常値（赤字プロジェクト）のアラート。 |
| **プロジェクト別損益レポート** | プロジェクト単位のP\&L。**標準原価と実績原価の切り替え表示**。 |
| **PM別・部署別集計** | PMごとの予算達成率、担当プロジェクトの合算損益。 |
| **クライアント別収益レポート** | クライアント別の売上・利益・粗利率の推移。LTVの可視化。 |
| **稼働・コスト乖離分析** | 「予定工数 vs 実績工数」および「標準原価ベース vs 人件費実績ベース」の比較。 |

---

## **4\. 特徴的な画面の深掘り：プロジェクト損益分析画面**

この画面では、以下のような「切り替え機能」を持たせる設計が考えられます。

### **表示項目例**

* **売上**: 受注金額（按分処理後）  
* **直接原価（人件費）**: 以下の2軸をトグルスイッチで切り替え  
  * **標準原価モード**: Σ(稼働時間 × 各人の標準単価)  
  * **人件費実績モード**: Σ(稼働時間 × 当月の実際算出単価)  
* **直接原価（外部）**: Σ(パートナー稼働時間 × 契約単価)  
* **直接原価（その他）**: ライセンス仕入、経費  
* **プロジェクト利益 / 利益率**

注記：人件費実績ベースの計算式

特定のプロジェクトにおける社員Aの実際コストは、以下の式で導出されます。

$$ActualCost\_{project} \= \\frac{TotalSalary\_{A}}{TotalWorkHours\_{A}} \\times WorkHours\_{A, project}$$

# データモデル、ER図

``` plantuml
@startuml
skinparam linetype ortho
skinparam shadowing false

entity "clients (顧客マスタ)" as client {
  * client_id : PK
  --
  name : 顧客名
  industry : 業界
  payment_terms : 支払条件
}

entity "projects (プロジェクトマスタ)" as project {
  * project_id : PK
  --
  # client_id : FK
  # pm_employee_id : FK (PM)
  name : プロジェクト名
  service_type : サービス種別 (コンサル/テスト/ライセンス)
  start_date : 開始日
  end_date : 終了日
  contract_amount : 受注金額
  status : 状態 (稼働中/完了等)
}

entity "contracts (契約テーブル)" as contract {
  * contract_id : PK
  --
  # project_id : FK
  contract_number : 契約枝番/契約番号
  start_date : **契約開始日**
  end_date : **契約終了日**
  contract_amount : **契約金額 (売上)**
  contract_status : ステータス (締結済/交渉中等)
}

entity "employees (社員マスタ)" as employee {
  * employee_id : PK
  --
  name : 氏名
  department : 所属部署
  standard_unit_cost : **標準単価(/h)**
}

entity "partners (外部パートナーマスタ)" as partner {
  * partner_id : PK
  --
  name : 氏名
  company_name : 所属会社
  contract_unit_price : 契約単価(/h or 月額)
}

entity "work_records (稼働実績 - CSV取込)" as work {
  * record_id : PK
  --
  # project_id : FK
  # resource_id : FK (社員orパートナー)
  work_date : 稼働日
  hours : **稼働時間**
}

entity "monthly_actual_costs (人件費実績)" as actual_cost {
  * cost_id : PK
  --
  # employee_id : FK
  target_month : 対象年月
  total_salary : **総支給額(実績給与)**
  total_work_hours : 月間総労働時間
}

entity "expense_records (経費・仕入実績)" as expense {
  * expense_id : PK
  --
  # project_id : FK
  expense_type : 費目 (ライセンス仕入/旅費等)
  amount : 金額
  occurred_date : 発生日
}

' リレーションシップ
client ||--o{ project
employee ||--o{ project : "PMとして担当"
project ||--o{ work
project ||--o{ expense
employee ||--o{ work
partner ||--o{ work
employee ||--o{ actual_cost
project ||--o{ contract : "**1プロジェクトに対し複数の契約**"

note right of project
  service_typeにより
  利益計算ロジックを分岐
end note

@enduml

```

# 課題に対する対応

1. **CSVの「名寄せ」**: 勤怠CSVの氏名やプロジェクト名が、システム側のマスタと100%一致しない場合：システム的には、勤怠CSV取り込み時はエラーにして更新しない。運用でシステム側を更新して、エラーを解消させる（勤怠システム側を正とする）  
2. **標準原価の更新タイミング**: 標準原価は年次で見直しされる。見直しがあった際には、過去の実績データに遡及させない。なお標準原価はhistoryを3世代保持する。  
3. **ライセンス販売の「期間按分」**: 1年間のライセンス契約の場合、売上を12ヶ月に按分して月次損益に反映させる機能が必要